from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils.keyboard import InlineKeyboardBuilder
from models import TaskType, TaskStatus

def get_main_keyboard() -> ReplyKeyboardMarkup:
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½ÑƒÑ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ´Ğ»Ñ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ
    keyboard = [
        [KeyboardButton(text="ğŸ†• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ´Ğ°Ñ‡Ñƒ")],
        [KeyboardButton(text="ğŸ“‹ ĞœĞ¾Ğ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸"), KeyboardButton(text="ğŸ”„ Ğ—Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°")],
        [KeyboardButton(text="ğŸ‘« ĞĞ±Ñ‰Ğ¸Ğµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸")]
    ]
    return ReplyKeyboardMarkup(keyboard=keyboard, resize_keyboard=True)

def get_task_type_keyboard() -> InlineKeyboardMarkup:
    # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ‚Ğ¸Ğ¿Ğ° Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ñ€Ğ¸ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğ¸
    builder = InlineKeyboardBuilder()
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ±Ğ¸Ğ»Ğ´ĞµÑ€
    builder.button(text="ğŸ™‹â€â™‚ï¸ Ğ”Ğ»Ñ ÑĞµĞ±Ñ", callback_data=f"task_type:{TaskType.FOR_ME.value}")
    builder.button(text="ğŸ‘©â€â¤ï¸â€ğŸ‘¨ Ğ”Ğ»Ñ Ğ¿Ğ°Ñ€Ñ‚Ğ½ĞµÑ€Ğ°", callback_data=f"task_type:{TaskType.FOR_PARTNER.value}")
    builder.button(text="ğŸ‘« Ğ”Ğ»Ñ Ğ¾Ğ±Ğ¾Ğ¸Ñ…", callback_data=f"task_type:{TaskType.FOR_BOTH.value}")
    
    # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ¾Ğ´Ğ¸Ğ½ ÑÑ‚Ğ¾Ğ»Ğ±ĞµÑ†
    builder.adjust(1)
    
    return builder.as_markup()

def get_task_action_keyboard(task_id: int, task_status: TaskStatus) -> InlineKeyboardMarkup:
    # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğ¹ Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡ĞµĞ¹ (Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€, Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ, ÑƒĞ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ)
    builder = InlineKeyboardBuilder()
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ´Ğ»Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ÑÑ‚Ğ°Ñ‚ÑƒÑĞ°
    status_text = "âœ… ĞÑ‚Ğ¼ĞµÑ‚Ğ¸Ñ‚ÑŒ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ½Ñ‹Ğ¼" if task_status == TaskStatus.ACTIVE else "ğŸ”„ Ğ’ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ² Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ"
    status_value = TaskStatus.COMPLETED.value if task_status == TaskStatus.ACTIVE else TaskStatus.ACTIVE.value
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ±Ğ¸Ğ»Ğ´ĞµÑ€
    builder.button(text=status_text, callback_data=f"task_status:{task_id}:{status_value}")
    builder.button(text="âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ", callback_data=f"edit_task:{task_id}")
    builder.button(text="ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ", callback_data=f"delete_task:{task_id}")
    builder.button(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data="back_to_tasks")
    
    # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ¾Ğ´Ğ¸Ğ½ ÑÑ‚Ğ¾Ğ»Ğ±ĞµÑ†
    builder.adjust(1)
    
    return builder.as_markup()

def get_tasks_list_keyboard(tasks, page=0, page_size=5) -> InlineKeyboardMarkup:
    # ĞŸĞ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ ÑĞ¿Ğ¸ÑĞºĞ° Ğ·Ğ°Ğ´Ğ°Ñ‡
    builder = InlineKeyboardBuilder()
    
    start = page * page_size
    end = min(start + page_size, len(tasks))
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ½Ğ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ğµ
    for i in range(start, end):
        task = tasks[i]
        status_emoji = "âœ…" if task.status == TaskStatus.COMPLETED else "ğŸ”„"
        # ĞĞ±Ñ€ĞµĞ·Ğ°ĞµĞ¼ Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡
        title_display = task.title[:30] + "..." if len(task.title) > 30 else task.title
        builder.button(
            text=f"{status_emoji} {title_display}", 
            callback_data=f"view_task:{task.id}"
        )
    
    # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ·Ğ°Ğ´Ğ°Ñ‡ Ğ² Ğ¾Ğ´Ğ¸Ğ½ ÑÑ‚Ğ¾Ğ»Ğ±ĞµÑ†
    builder.adjust(1)
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸, ĞµÑĞ»Ğ¸ Ğ¾Ğ½Ğ¸ Ğ½ÑƒĞ¶Ğ½Ñ‹
    pagination_buttons = []
    
    if page > 0:
        builder.button(text="â¬…ï¸ ĞĞ°Ğ·Ğ°Ğ´", callback_data=f"page:{page-1}")
    
    if end < len(tasks):
        builder.button(text="â¡ï¸ Ğ’Ğ¿ĞµÑ€ĞµĞ´", callback_data=f"page:{page+1}")
    
    # Ğ•ÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸, Ñ€Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ Ğ¸Ñ… Ğ² Ğ¾Ğ´Ğ½Ñƒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ
    if page > 0 or end < len(tasks):
        # Ğ—Ğ´ĞµÑÑŒ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ² Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ¹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ - ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ğ¸ (1 Ğ¸Ğ»Ğ¸ 2)
        builder.adjust(1, 2)  
    
    # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ° Ğ² Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ
    builder.button(text="ğŸ  Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ¼ĞµĞ½Ñ", callback_data="main_menu")
    builder.adjust(1)  # ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ¼ĞµĞ½Ñ Ğ² Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ ÑÑ‚Ñ€Ğ¾ĞºĞµ
    
    return builder.as_markup()

def get_cancel_keyboard() -> InlineKeyboardMarkup:
    # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½Ñ‹ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
    builder = InlineKeyboardBuilder()
    builder.button(text="âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°", callback_data="cancel")
    return builder.as_markup()

def get_confirm_keyboard(action: str, task_id: int) -> InlineKeyboardMarkup:
    # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ñ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ
    builder = InlineKeyboardBuilder()
    builder.button(text="âœ… Ğ”Ğ°", callback_data=f"confirm_{action}:{task_id}")
    builder.button(text="âŒ ĞĞµÑ‚", callback_data=f"view_task:{task_id}")
    
    # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ¾Ğ´Ğ½Ñƒ ÑÑ‚Ñ€Ğ¾ĞºÑƒ (2 ĞºĞ½Ğ¾Ğ¿ĞºĞ¸)
    builder.adjust(2)
    
    return builder.as_markup()

def get_edit_menu_keyboard(task_id: int) -> InlineKeyboardMarkup:
    # ĞšĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¼ĞµĞ½Ñ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
    builder = InlineKeyboardBuilder()
    builder.button(text="ğŸ“Œ ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", callback_data="edit:title")
    builder.button(text="ğŸ“ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ", callback_data="edit:description")
    builder.button(text="ğŸ‘¥ Ğ¢Ğ¸Ğ¿ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸", callback_data="edit:type")
    builder.button(text="ğŸ”™ ĞĞ°Ğ·Ğ°Ğ´", callback_data=f"view_task:{task_id}")
    
    # Ğ Ğ°Ğ·Ğ¼ĞµÑ‰Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ² Ğ¾Ğ´Ğ¸Ğ½ ÑÑ‚Ğ¾Ğ»Ğ±ĞµÑ†
    builder.adjust(1)
    
    return builder.as_markup()